name: 🎪 🖥️ 🛠️
on: push
jobs:

  rocm:
    name: 🐧 Build onnxruntime-rocm wheels
    runs-on: ubuntu-latest
    steps:

    - uses: easimon/maximize-build-space@master
      with:
        remove-dotnet: true
        remove-android: true
        remove-haskell: true
        remove-codeql: true
        remove-docker-images: true

    - uses: docker/setup-buildx-action@v2
    - uses: docker/build-push-action@v4
      with:
        tags: onnxruntime-rocm

    - uses: addnab/docker-run-action@v3
      with:
        image: onnxruntime-rocm
        options: -v ${{ github.workspace }}:/opt/mount
        run: cp -r /code/onnxruntime/build/Linux/Release/dist/*.whl /opt/mount

    - uses: actions/upload-artifact@v3
      with:
        path: onnxruntime*.whl